<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Things to do after renting a VPS | Colgrave’s Blog</title><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Things to do after renting a VPS" /><meta property="og:locale" content="en_US" /><link rel="canonical" href="https://blog.hanqixu.com/Linux%20Lighthouse/vps_post-install/" /><meta property="og:url" content="https://blog.hanqixu.com/Linux%20Lighthouse/vps_post-install/" /><meta property="og:site_name" content="Colgrave’s Blog" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Things to do after renting a VPS" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Things to do after renting a VPS","url":"https://blog.hanqixu.com/Linux%20Lighthouse/vps_post-install/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header" role="banner"> <a href="/" class="site-title lh-tight"> Colgrave's Blog </a> <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false"> <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Posts category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Posts/" class="nav-list-link">Posts</a><ul class="nav-list"></ul><li class="nav-list-item active"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linux Lighthouse category" aria-pressed="true"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Linux%20Lighthouse/" class="nav-list-link">Linux Lighthouse</a><ul class="nav-list"><li class="nav-list-item active"><a href="/Linux%20Lighthouse/vps_post-install/" class="nav-list-link active">Things to do after renting a VPS</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Linux灯塔 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Linux%E7%81%AF%E5%A1%94/" class="nav-list-link">Linux灯塔</a><ul class="nav-list"><li class="nav-list-item "><a href="/Linux%E7%81%AF%E5%A1%94/MC%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9E%B6%E8%AE%BE%E6%95%99%E7%A8%8B/" class="nav-list-link">MC服务器架设教程</a><li class="nav-list-item "><a href="/Linux%E7%81%AF%E5%A1%94/MC%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9E%E6%8E%A5%E6%95%99%E7%A8%8B%E5%92%8CMOD%E5%AE%89%E8%A3%85/" class="nav-list-link">MC服务器连接教程和MOD安装</a><li class="nav-list-item "><a href="/Linux%E7%81%AF%E5%A1%94/%E8%BF%98%E5%9C%A8%E8%8A%B1%E9%92%B1%E5%81%9A%E7%AC%94%E8%AE%B0/" class="nav-list-link">还在花钱做笔记?</a></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Custom Keyboard 101 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Custom%20Keyboard%20101/" class="nav-list-link">Custom Keyboard 101</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in 客制化键盘指北 category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/%E5%AE%A2%E5%88%B6%E5%8C%96%E9%94%AE%E7%9B%98%E6%8C%87%E5%8C%97/" class="nav-list-link">客制化键盘指北</a><ul class="nav-list"></ul><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Projects category" aria-pressed="false"> <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg> </button><a href="/Projects/" class="nav-list-link">Projects</a><ul class="nav-list"></ul></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search" role="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Colgrave's Blog" aria-label="Search Colgrave's Blog" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://hanqixu.com" class="site-button" > hanqixu.com </a><li class="aux-nav-list-item"> <a href="https://sspai.com/u/11l4rhh4/updates" class="site-button" > 少数派 </a><li class="aux-nav-list-item"> <a href="https://codeberg.org/Colgrave/blog" class="site-button" > View on Codeberg </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/Linux%20Lighthouse/">Linux Lighthouse</a><li class="breadcrumb-nav-list-item"><span>Things to do after renting a VPS</span></ol></nav><div id="main-content" class="main-content"><main><h1 id="things-to-do-after-rent-a-vps"> <a href="#things-to-do-after-rent-a-vps" class="anchor-heading" aria-labelledby="things-to-do-after-rent-a-vps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Things to do after rent a VPS</h1><p>So I heard you are ready to spin up a Cloud VPS? No problem. But you got some setup to do, such as security and automatic updates.</p><p>I’m using Debian as the guide here. If you are using different distros, commands are different.</p><ul><li><a href="#users-and-sudo">Users and sudo</a><li><a href="#disable-root-ssh">Disable Root SSH</a><li><a href="#firewall-ports">Firewall ports</a><li><a href="#change-ssh-service-port">Change SSH service port</a><li><a href="#unattended-upgrades">Unattended Upgrades</a><li><a href="#at-the-end">At the end</a></ul><h2 id="users-and-sudo"> <a href="#users-and-sudo" class="anchor-heading" aria-labelledby="users-and-sudo"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Users and sudo</h2><p>Linux is the kind of Operating system that will do what you exactly want them to do. So don’t run commands in root and don’t use root account as your account. Secondly, when you log in as root, every application you run will run with root privileges. This might lead to apps deleting files, creating files in different places that they shouldn’t. And it will break your system.</p><p>Most VPS company will set the machine up as root and give you the freedom to do anything. So we are going to create a user, give it superuser privileges.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adduser yourusername # Add user yourusername
usermod -aG sudo yourusername # Put yourusername to sudo group
</code></pre></div></div><p>Now you have your own user! <code class="language-plaintext highlighter-rouge">exit</code> the root user and login in as your new user.</p><h2 id="disable-root-ssh"> <a href="#disable-root-ssh" class="anchor-heading" aria-labelledby="disable-root-ssh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disable Root SSH</h2><p>We are going to disable the root user from login using ssh. To ensure more security and reduce attack surface. I’m using vim, you can use nano or other text editor.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo vim /etc/ssh/sshd_config
</code></pre></div></div><p>When editing the system, configure files needs superuser privileges.<br /> In the config file, find the line <code class="language-plaintext highlighter-rouge">PermitRootLogin yes</code>, and replace the word <code class="language-plaintext highlighter-rouge">yes</code> with <code class="language-plaintext highlighter-rouge">no</code>. <img src="/assets/a72b9315090d1ac9020ee4f88c8b2ff0.png" alt="a72b9315090d1ac9020ee4f88c8b2ff0.png" /> Save the file and restart ssh.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart sshd
</code></pre></div></div><h2 id="firewall-ports"> <a href="#firewall-ports" class="anchor-heading" aria-labelledby="firewall-ports"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Firewall ports</h2><p>Here we are going to reduce more attack surface by limiting Firewall ports.<br /> I use Uncomplicated Firewall (ufw) on my Debian box.<br /> Install it by using <code class="language-plaintext highlighter-rouge">sudo apt install -y ufw</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ufw status
</code></pre></div></div><p>This command will tell you if your firewall is active and list out all the ports that are open. <img src="/assets/a1a25ea15a3be36e5fb16d599c23b4b3.png" alt="a1a25ea15a3be36e5fb16d599c23b4b3.png" /> For me, I use this server as a web server and reverse proxy on it.</p><p>To ensure security, I want to close a port I no longer needed.<br /> For example, I want to close port 8448:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo ufw deny 8448
sudo ufw reload
</code></pre></div></div><p>Always close ports you are no longer needed.<br /> Don’t forget to reload your firewall after setting it up.</p><h2 id="change-ssh-service-port"> <a href="#change-ssh-service-port" class="anchor-heading" aria-labelledby="change-ssh-service-port"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Change SSH service port</h2><p>Secure Shell uses port 22. There’s nothing wrong with using this port, but it is too common. It’s really easy to determent if your machine is using SSH or not. The best practice is to change it to another port.</p><p>Let’s open up SSH’s config file again. <img src="/assets/4b9e1e28a98289be53edc3ab082565af.png" alt="4b9e1e28a98289be53edc3ab082565af.png" /> Change this port to any ports higher than 3000.</p><p>Make sure you have that port opened on your firewall, and restart both your SSH service and your firewall.</p><h2 id="unattended-upgrades"> <a href="#unattended-upgrades" class="anchor-heading" aria-labelledby="unattended-upgrades"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Unattended Upgrades</h2><p>This is the software that automatic updates your machines when you’re using Debian based systems (Ubuntu, etc…)<br /> <a href="https://help.ubuntu.com/community/AutomaticSecurityUpdates">AutomaticSecurityUpdates</a></p><p>If you are using RHEL, CentOS, AlmaLinux, RockyLinux for fedora. <br /> <a href="https://dnf.readthedocs.io/en/latest/automatic.html">DNF Automatic</a><br /> <a href="https://www.fedoraproject.org/wiki/AutoUpdates">Fedora Wiki AutoUpdates</a><br /> If you are using openSUSE<br /> <a href="https://en.opensuse.org/YaST_Online_Update">YaST Online Update</a></p><p>The config file /etc/apt/apt.conf.d/20auto-upgrades can be easily created by run the following command as root:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dpkg-reconfigure -plow unattended-upgrades
</code></pre></div></div><p><img src="/assets/69a9a2fb9e89dd91a3661e30ddb9b03b.png" alt="69a9a2fb9e89dd91a3661e30ddb9b03b.png" /> Select <code class="language-plaintext highlighter-rouge">yes</code> and It should generate the config files automatically. Now we need to edit the config file for the things you want to automatic updates.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo vim /etc/apt/apt.conf.d/50unattended-upgrades
</code></pre></div></div><p><img src="/assets/dc8b2631c664f924196a7d39e45b9035.png" alt="dc8b2631c664f924196a7d39e45b9035.png" /> There are some lines you need to uncomment, for example <code class="language-plaintext highlighter-rouge">"origin=Debian,codename=${distro_codename}-updates"</code>.<br /> Uncomment this line will download every new packages, which is what I want my system to stay up to date all the time.<br /> You can also just only uncommon the <code class="language-plaintext highlighter-rouge">"Debian-Security"</code>. This will only update for security rollouts.</p><p>There’s nothing wrong with stay on older packages, it will bring you the best stability. But I wanted my system to be up-to-date. It is all personal preference.</p><p><img src="/assets/9739e5a649c89fb3bf0810349b84f457.png" alt="9739e5a649c89fb3bf0810349b84f457.png" /> Here are some line you can also uncomment:<br /> <code class="language-plaintext highlighter-rouge">Remove-Unused-Kernel-Packages</code><br /> This will remove the old kernel that is no longer needed.<br /> <code class="language-plaintext highlighter-rouge">Remove-New-Unused-Dependencies</code><br /> This will remove unused dependencies if a package updated and no longer needed.<br /> <code class="language-plaintext highlighter-rouge">Remove-Unused Dependencies</code><br /> This will remove unused dependencies.</p><p>Remove-New-Unused-Dependencies and Remove-Unused Dependencies works the same as command <code class="language-plaintext highlighter-rouge">sudo apt autoremove</code></p><p>Last but not least, let’s check if we have done it correctly.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cat /etc/apt/apt.conf.d/20auto-upgrades
apt-config dump APT::Periodic::Unattended-Upgrade
</code></pre></div></div><p><img src="/assets/4316a50179e1fe474a1774f5f492d4df.png" alt="4316a50179e1fe474a1774f5f492d4df.png" /> Both commands should return something like <code class="language-plaintext highlighter-rouge">Unattended-Upgrade "1";</code>. This indicates that your configuration is correct.</p><h2 id="at-the-end"> <a href="#at-the-end" class="anchor-heading" aria-labelledby="at-the-end"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> At the end</h2><p>Even tho we have already set up the automatic updates, I still highly recommend you log in from time to time to check the SELinux log if anything is not running correctly. Thanks for reading!</p></main><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p><p class="text-small text-grey-dk-100 mb-0">Colgrave's Blog 🄯 2022-2023 by Hanqi Xu · Site content is under <a href="https://creativecommons.org/licenses/by-sa/4.0/"> CC BY-SA 4.0</a> · <a href="https://codeberg.org/Colgrave/blog">Site code</a> is under <a href="https://www.gnu.org/licenses/gpl-3.0.html/"> GPLv3</a></p><div class="d-flex mt-2"></div></footer></div></div><div class="search-overlay"></div></div>
